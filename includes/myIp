SiteClass.class.php:define("SITE_CLASS_VERSION", "3.7.0"); // BLP 2023-03-01 - 
SiteClass.class.php:    parent::__construct($s, true); // BLP 2023-03-04 - second arg is true because this is called from SiteClass!
SiteClass.class.php:    // BLP 2018-07-01 -- Add the date to the copyright notice if one exists
SiteClass.class.php:    if($this->copyright) {
SiteClass.class.php:      $this->copyright = date("Y") . " $this->copyright";
SiteClass.class.php:    return $this->hitCount;
SiteClass.class.php:    return $this->doctype;
SiteClass.class.php:    $top = $this->getPageTop();
SiteClass.class.php:    // BLP 2022-04-09 - We can pass in a footer via $h.
SiteClass.class.php:    $footer = $this->footer ?? $this->getPageFooter();
SiteClass.class.php:    // return the array which we usually get via '[$top, $footer] = $S->getPageTopBottom($h, $b)'
SiteClass.class.php:    $head = $this->getPageHead();
SiteClass.class.php:    $banner = $this->getPageBanner();
SiteClass.class.php:    $this->getPageHead = true; // BLP 2023-01-31 -
SiteClass.class.php:    $dtype = $this->doctype; // note that $this->doctype could also be from mysitemap.json see the constructor.
SiteClass.class.php:    $h->base = $this->base ? "<base src='$this->base'>" : null;
SiteClass.class.php:    $h->title = $this->title ? "<title>$this->title</title>" : null;
SiteClass.class.php:    $h->desc = $this->desc ? "<meta name='description' content='$this->desc'>" : null;
SiteClass.class.php:    $h->keywords = $this->keywords ? "<meta name='keywords' content='$this->keywords'>" : null;
SiteClass.class.php:    $h->copyright = $this->copyright ? "<meta name='copyright' content='$this->copyright'>" : null;
SiteClass.class.php:    $h->author = $this->author ? "<meta name='author' content='$this->author'>" : null;
SiteClass.class.php:    $h->charset = $this->charset ? "<meta charset='$this->charset'>" : "<meta charset='utf-8'>";
SiteClass.class.php:    $h->viewport = $this->viewport ? "<meta name='viewport' content='$this->viewport'>" :
SiteClass.class.php:                   "<meta name='viewport' content='width=device-width, initial-scale=1'>";
SiteClass.class.php:    $h->canonical = $this->canonical ? "<link rel='canonical' href='$this->canonical'>" : null;
SiteClass.class.php:    $h->meta = $this->meta;
SiteClass.class.php:    $h->favicon = $this->favicon ? "<link rel='shortcut icon' href='$this->favicon'>" :
SiteClass.class.php:    if($this->defaultCss === false) { // If this is false NO default
SiteClass.class.php:      $h->defaultCss = null;
SiteClass.class.php:      $h->defaultCss = $this->defaultCss ? "<link rel='stylesheet' href='$this->defaultCss' title='default'>" :
SiteClass.class.php:    // $h->css is a special case. If the style is not already there incase the text in <style> tags.
SiteClass.class.php:    $h->css = $this->css;
SiteClass.class.php:    if($this->css && preg_match("~<style~", $this->css) == 0) {
SiteClass.class.php:      $h->css = "<style>$this->css</style>";
SiteClass.class.php:    // We set the $h->inlineScript here with h_inlineScript
SiteClass.class.php:    $h->inlineScript = $this->h_inlineScript ? "<script>\n$this->h_inlineScript\n</script>" : null;
SiteClass.class.php:    // The rest, $h->link, $h->script and $h->extra need the full '<link' or '<script' text.
SiteClass.class.php:    $h->script = $this->h_script;
SiteClass.class.php:    $h->link = $this->link;
SiteClass.class.php:    $h->extra = $this->extra;
SiteClass.class.php:    $preheadcomment = $this->preheadcomment; // Must be a real html comment ie <!-- ... -->
SiteClass.class.php:    $lang = $this->lang ?? 'en';
SiteClass.class.php:    $htmlextra = $this->htmlextra; // Must be full html
SiteClass.class.php:    if($this->nojquery !== true) {
SiteClass.class.php:  <!-- jQuery BLP 2022-12-21 - Latest version -->
SiteClass.class.php:  <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
SiteClass.class.php:  <script src="https://code.jquery.com/jquery-migrate-3.4.0.min.js" integrity="sha256-mBCu5+bVfYzOqpYyK4jm30ZxAZRomuErKEFJFIyrwvM=" crossorigin="anonymous"></script>
SiteClass.class.php:      if($this->noTrack === true || $this->nodb === true) {
SiteClass.class.php:        // BLP 2023-02-20 - trackerLocationJs needs to be part of $this for whatisloaded.class.php.
SiteClass.class.php:        $this->trackerLocationJs = $this->trackerLocationJs ?? "https://bartonlp.com/otherpages/js/tracker.js";
SiteClass.class.php:        $trackerLocation = $this->trackerLocation ?? "https://bartonlp.com/otherpages/tracker.php";
SiteClass.class.php:        $beaconLocation = $this->beaconLocation ?? "https://bartonlp.com/otherpages/beacon.php";
SiteClass.class.php:  <script data-lastid="$this->LAST_ID" src="$this->trackerLocationJs"></script>
SiteClass.class.php:    var thesite = "$this->siteName",
SiteClass.class.php:    theip = "$this->ip",
SiteClass.class.php:    thepage = "$this->self",
SiteClass.class.php:    if(!is_null($this->headFile)) {
SiteClass.class.php:      if(($p = require_once($this->headFile)) != 1) {
SiteClass.class.php:        throw new SqlException(__CLASS__ . " " . __LINE__ .": $this->siteName, getPageHead() headFile '$this->headFile' returned 1", $this);
SiteClass.class.php:<!-- Default Head -->
SiteClass.class.php:$h->title
SiteClass.class.php:  <!-- METAs -->
SiteClass.class.php:  <meta charset="utf-8"/>
SiteClass.class.php:  <meta name="description" content="{$this->desc}"/>
SiteClass.class.php:  <!-- local link -->
SiteClass.class.php:$this->link
SiteClass.class.php:  <!-- extra -->
SiteClass.class.php:$h->extra
SiteClass.class.php:  <!-- remote script -->
SiteClass.class.php:$h->script
SiteClass.class.php:  <!-- inline script -->
SiteClass.class.php:$h->inlineScript
SiteClass.class.php:  <!-- local css -->
SiteClass.class.php:$h->css
SiteClass.class.php:   * BLP 2022-01-30 -- New logic
SiteClass.class.php:    // BLP 2022-04-09 - These need to be checked here.
SiteClass.class.php:    $bodytag = $this->bodytag ?? "<body>";
SiteClass.class.php:    $mainTitle = $this->banner ?? $this->mainTitle;
SiteClass.class.php:    // BLP 2022-04-09 - if we have nodb or noTrack then there will be no tracker.js or tracker.php
SiteClass.class.php:    $trackerLocation = $this->trackerLocation ?? "https://bartonlp.com/otherpages/tracker.php";
SiteClass.class.php:    if($this->nodb !== true && $this->noTrack !== true) {
SiteClass.class.php:      // BLP 2022-03-24 -- Add alt and add src='blank.gif'
SiteClass.class.php:      // BLP 2022-04-09 - for now I am leaving trackerImg1 and trackerImg2 only on $this.
SiteClass.class.php:      $image1 = "<img id='logo' data-image='$this->trackerImg1' alt='logo' src=''>";
SiteClass.class.php:      $image2 = "<img id='headerImage2' alt='headerImage2' src='$trackerLocation?page=normal&amp;id=$this->LAST_ID&amp;image=$this->trackerImg2'>";
SiteClass.class.php:      $image3 = "<img id='noscript' alt='noscriptImage' src='$trackerLocation?page=noscript&amp;id=$this->LAST_ID'>";
SiteClass.class.php:    if(!is_null($this->bannerFile)) {
SiteClass.class.php:      $pageBannerText = require($this->bannerFile);
SiteClass.class.php:<!-- Default Header/Banner -->
SiteClass.class.php:<noscript style="color: red; border: 1px solid black; padding: 10px; font-size: large;">
SiteClass.class.php:    // BLP 2022-01-02 -- if nofooter is true just return an empty footer
SiteClass.class.php:    if($this->nofooter === true) {
SiteClass.class.php:    // BLP 2022-02-23 -- added the following.
SiteClass.class.php:    $b->ctrmsg = $this->ctrmsg;
SiteClass.class.php:    $b->msg = $this->msg;
SiteClass.class.php:    $b->msg1 = $this->msg1;
SiteClass.class.php:    $b->msg2 = $this->msg2;
SiteClass.class.php:    $b->address = $this->noAddress ? null : ($this->address . "<br>");
SiteClass.class.php:    $noCopyright = $this->noCopyright;
SiteClass.class.php:    $b->copyright = $noCopyright ? null : ($this->copyright . "<br>");
SiteClass.class.php:    if(preg_match("~^\d{4}~", $b->copyright) === 1) {
SiteClass.class.php:      $b->copyright = "Copyright &copy; $b->copyright";
SiteClass.class.php:    $b->aboutwebsite = $this->aboutwebsite ??
SiteClass.class.php:                       "<h2><a target='_blank' href='https://bartonlp.com/otherpages/aboutwebsite.php?site=$this->siteName&domain=$this->siteDomain'>About This Site</a></h2>";
SiteClass.class.php:    $b->emailAddress = $this->noEmailAddress ? null : ($this->emailAddress ?? $this->EMAILADDRESS);
SiteClass.class.php:    $b->emailAddress = $this->emailAddress ? "<a href='mailto:$this->emailAddress'>$this->emailAddress</a>" : null;
SiteClass.class.php:    $b->inlineScript = $this->b_inlineScript ? "<script>\n$this->b_inlineScript\n</script>" : null;
SiteClass.class.php:    $b->script = $this->b_script;
SiteClass.class.php:    // BLP 2022-01-02 -- if count is set then use the counter
SiteClass.class.php:    if($this->noCounter !== true) {
SiteClass.class.php:      $counterWigget = $this->getCounterWigget($this->ctrmsg); // ctrmsg may be null which is OK
SiteClass.class.php:    // BLP 2021-10-24 -- lastmod is also available to footerFile to use if wanted.
SiteClass.class.php:    if($this->noLastmod !== true) {
SiteClass.class.php:    // BLP 2022-01-28 -- add noGeo
SiteClass.class.php:    if($this->noGeo !== true) {
SiteClass.class.php:      $geo = $this->gioLocation ?? "https://bartonphillips.net/js";
SiteClass.class.php:    // BLP 2022-04-09 - We can put the footerFile into $b or use it from mysitemap.json
SiteClass.class.php:    // If either is set to 'false' then use the default footer, else use $this->footerFile unless
SiteClass.class.php:    if($this->footerFile !== false && $this->footerFile !== null) {
SiteClass.class.php:      $pageFooterText = require($this->footerFile);
SiteClass.class.php:<!-- Default Footer -->
SiteClass.class.php:$b->aboutwebsite
SiteClass.class.php:$b->script
SiteClass.class.php:$b->inlineScript
SiteClass.class.php:    $hits = number_format($this->hitCount);
beacon.php:define("BEACON_VERSION", "3.0.2beacon"); // BLP 2023-01-30 - Add check for $_site.
beacon.php:$DEBUG1 = true; // COUNTED real+1 bots-1
beacon.php:$S->isMeFalse = $data['isMeFalse'];
beacon.php:  error_log("beacon:  NO ID, $ip, $site, $msg -- visits=$visits, \$S->ip=$S->ip, \$S->self=$S->self, \$S->agent=$S->agent, time=" . (new DateTime)->format('H:i:s:v'));
beacon.php:  $S->query("insert into $S->masterdb.badplayer (ip, site, page, botAs, type, count, errno, errmsg, agent, created, lasttime) " .
beacon.php:            "values('$S->ip', '$site', '$S->self', 'counted', '{$msg}_BEACON_GOAWAY', 1, '-104', 'NO ID Go away', '$S->agent', now(), now()) ".
beacon.php:if($S->query("select botAs, isJavaScript, hex(isJavaScript), difftime, finger, agent from $S->masterdb.tracker where id=$id")) {
beacon.php:  [$botAs, $java, $js, $difftime, $finger, $agent] = $S->fetchrow('num');
beacon.php:// BLP 2023-03-11 - Remove $tmpBotsAs. This should stop multiple daycounts on exit
beacon.php:      error_log("beacon: $id, $ip, $site, $thepage, SWITCH_ERROR_{$type}, botAs=$botAs, java=$js, visits=$visits -- \$S->ip=$S->ip, \$S->agent=$S->agent");
beacon.php:  if($DEBUG_IPS && ($ip != $S->ip)) {
beacon.php:    error_log("beacon:  $id, $ip, $site, $thepage, IP_MISMATCH_{$msg}, \$ip != \$S->ip -- \$S->ip=$S->ip, botAs=$botAs, jsin=$js, jsout=$js2, visits=$visits");
beacon.php:  if($agent && $S->isBot($agent)) {
beacon.php:    if($DEBUG_ISABOT) error_log("beacon:  $id, $ip, $site, $thepage, ISABOT_{$msg}1, state=$state, botAs=$botAs, visits=$visits, jsin=$js, jsout=$js2, time=" . (new DateTime)->format('H:i:s:v'));
beacon.php:      if($DEBUG_ISABOT) error_log("tracker: $id, $ip, $site, $thepage, ISABOT_{$msg}2, state=$state, botAs=$botAs, visits=$visits, jsin=$js, jsout=$js2, difftime=$difftime, time=" . (new DateTime)->format('H:i:s:v'));
beacon.php:  if(!$S->isMyIp($ip) && !str_contains($botAs, BOTAS_COUNTED)) { // it is not ME and it has not been counted yet.
beacon.php:    $S->query("select `real`, bots, visits from $S->masterdb.daycounts where date=current_date() and site='$site'");
beacon.php:    [$dayreal, $daybots, $dayvisits] = $S->fetchrow('num');
beacon.php:    $S->query("update $S->masterdb.daycounts set `real`=$dayreal, visits=$dayvisits where date=current_date() and site='$site'");
beacon.php:    if($DEBUG1) error_log("beacon:  $id, $ip, $site, $thepage, COUNTED_{$msg}1, real+1, botAs=$botAs, state=$state, jsin=$js, jsout=$js2, real=$dayreal, bots=$daybots, visits: $visits, time=" . (new DateTime)->format('H:i:s:v'));
beacon.php:  $S->query("update $S->masterdb.tracker set botAs='$botAs', endtime=now(), difftime=timestampdiff(second, starttime, now()), ".
beacon.php:  if(!$S->isMyIp($ip) && $DEBUG2)
beacon.php:    error_log("beacon:  $id, $ip, $site, $thepage, {$msg}2, state=$state, botAs=$botAs, visits=$visits, jsin=$js, jsout=$js2, difftime=$difftime, time=" . (new DateTime)->format('H:i:s:v'));
beacon.php:  if(!$S->isMyIp($ip) && $DEBUG3 && $type == 'visibilitychange')
beacon.php:    error_log("beacon:  $id, $ip, $site, $thepage, {$msg}3, state=$state, botAs=$botAs, visits=$visits, jsin=$js, jsout=$js2, difftime=$difftime, time=" . (new DateTime)->format('H:i:s:v'));
beacon.php:  error_log("beacon: Unexpected -- \$date $id,$ip, $site, $thepage, java=$js, type=$type -- \$S->siteName=$S->siteName, \$S->ip=$S->ip, time=" . (new DateTime)->format('H:i:s:v'));
beacon.php:  $S->query("insert into $S->masterdb.badplayer (ip, id, site, page, botAs, type, count, errno, errmsg, agent, created, lasttime) " .
beacon.php:            "values('$S->ip', $id, '$site', '$S->self', 'counted', 'GOAWAY_{$msg}', 1, '-105', 'Unexpected Go away', '$S->agent', now(), now()) ".
defines.php:// BLP 2022-04-24 - New. Values for SiteClass, tracker and beacon.
defines.php:  // 0x20000 (tracker called without info -- GoAway)
defines.php:  // 0x10000 (b-visibilitychanged)
defines.php:  // 0x800 (t-visibilitychange)
defines.php:  // 0x400 (t-pagehide)
defines.php:  // 0x200 (t-unload)
defines.php:  // 0x100 (t-beforeunload)
defines.php:  // 0x80 (b-beforeunload)
defines.php:  // 0x40 (b-unload)
defines.php:  // 0x20 (b-pagehide)
siteload.php:define("SITELOAD_VERSION", "2.0.0siteload"); // BLP 2023-01-30 - 
siteload.php:      $this->docroot = $_SERVER['DOCUMENT_ROOT'] ?? $S_SERVER['VIRTUALHOST_DOCUMENT_ROOT'];
siteload.php:    $this->mydir = $mydir;
siteload.php:    $this->_site = json_decode($this->findsitemap());
siteload.php:    $this->_site->siteloadVersion = SITELOAD_VERSION;
siteload.php:    $this->_site->siteClassDir = SITECLASS_DIR;
siteload.php:    if($mode = $this->_site->errorMode) {
siteload.php:      if($mode->development === true) { // true we are in development
siteload.php:      if($mode->noEmail === true) { // true means let there be emails
siteload.php:      } elseif($mode->noEmail === false) { // only if false, a null does nothing here.
siteload.php:      if($mode->noHtml === true) { 
siteload.php:      if($mode->noOutput === true) {
siteload.php:    $mydir = $this->mydir;
siteload.php:      return $this->stripComments(file_get_contents($mydir . "/mysitemap.json"));
siteload.php:      if($this->docroot == $mydir || '/' == $mydir) {
siteload.php:      $this->mydir = dirname($mydir);
siteload.php:      return $this->findsitemap();
siteload.php:  // This is the getter for the private $this->_site;
siteload.php:    return $this->_site;
siteload.php:  // BLP 2021-02-20 -- Added this to remove any comments that may be in my 'mystiemap.json'
siteload.php:$_site = (new getinfo())->getSite();
siteload.php:// BLP 2022-01-12 -- If $_site is NULL that means the json_decode() failed.
siteload.php:  // BLP 2022-01-12 -- try to make error log message more helpful
tracker.php:// BLP 2022-12-06 - Added rcount and bcount
tracker.php:define("TRACKER_VERSION", "3.0.2tracker"); // BLP 2023-01-30 - add check for $_site
tracker.php:$_site->count = false; // Don't count this.
tracker.php:  if($_POST['isMeFalse']) $S->isMeFalse = true;
tracker.php:  if(!$S->isMyIp($ip) && $DEBUG_MSG) error_log("tracker AJAXMSG $site, $ip: $msg{$args}");
tracker.php:  $ip = $_POST['ip']; // This is the real ip of the program. $S->ip will be the ip of ME.
tracker.php:  if($S->isMyIp($ip)) {
tracker.php:  if($S->query("select botAs, isJavaScript, hex(isJavaScript) from $S->masterdb.tracker where id=$id")) {
tracker.php:    [$botAs, $java, $js] = $S->fetchrow('num');
tracker.php:  } else { // BLP 2023-02-10 - add for debug
tracker.php:    error_log("tracker: $id, $ip, $site, $thispage,  Select of id=$id failed, time=" . (new DateTime)->format('H:I:s:v'));
tracker.php:  if(!$S->isMyIp($ip) && $DEBUG_START) {
tracker.php:    error_log("tracker: $id, $ip, $site, $thepage, START1, botAs=$botAs, referer=$ref, jsin=$js, jsout=$js2, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php:    $sql = "insert into $S->masterdb.tracker (id, botAs, site, page, ip, agent, referer, starttime, isJavaScript, lasttime) ".
tracker.php:    $sql = "insert into $S->masterdb.tracker (id, botAs, site, page, ip, agent, starttime, isJavaScript, lasttime) ".
tracker.php:  $S->query($sql);
tracker.php:  if($S->query("select botAs, isJavaScript, hex(isJavaScript) from $S->masterdb.tracker where id=$id")) {
tracker.php:    [$botAs, $java, $js] = $S->fetchrow('num');
tracker.php:  if(!$S->isMyIp($ip) && $DEBUG_LOAD && strpos($botAs, BOTAS_COUNTED) === false)
tracker.php:    error_log("tracker: $id, $ip, $site, $thepage, LOAD2, botAs=$botAs, jsin=$js, jsout=$js2, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php:  // BLP 2023-03-25 - This should maybe be insert/update?
tracker.php:  $S->query("update $S->masterdb.tracker set isJavaScript='$java', lasttime=now() where id='$id'");
tracker.php:// browsers and of course MS-Ie. Therefore these should not happen often.
tracker.php:// BLP 2022-10-27 - I have not seen one in several months so I am removing this logic and replacing
tracker.php:  $S->query("select botAs, isJavaScript, hex(isJavaScript), finger, agent from $S->masterdb.tracker where id=$id");
tracker.php:  [$botAs, $java, $js, $finger, $agent] = $S->fetchrow('num');
tracker.php:  if($S->isBot($agent)) {
tracker.php:    if($DEBUG_ISABOT) error_log("tracker: $id, $ip, $site, $thepage, ISABOT_TIMER1, botAs=$botAs, visits: $visits, jsin=$js, jsout=$js2, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php:      if($DEBUG_ISABOT) error_log("tracker: $id, $ip, $site, $thepage, ISABOT_TIMER2, state=$state, botAs=$botAs, visits=$visits, jsin=$js, jsout=$js2, difftime=$difftime, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php:  if(!$S->isMyIp($ip) && !str_contains($tmpBotAs, BOTAS_COUNTED)) {
tracker.php:      $sql = "select `real`, bots, visits from $S->masterdb.daycounts where date=current_date() and site='$site'";
tracker.php:      $S->query($sql);
tracker.php:      [$dayreal, $daybots, $dayvisits] = $S->fetchrow('num');
tracker.php:      $daybots = empty($datbots) ? 0 : $daybots; // BLP 2023-01-07 -
tracker.php:      $sql = "update $S->masterdb.daycounts set `real`='$dayreal', bots='$daybots', visits='$dayvisits' where date=current_date() and site='$site'";
tracker.php:      $S->query($sql);
tracker.php:      if($DEBUG_DAYCOUNT) error_log("tracker: $id, $ip, $site, $thepage, COUNTED_TIMER, real+1, visits=$visits, jsin=$js, jsout=$js2, real=$dayreal, bots=$daybots, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php:      // BLP 2022-12-06 - Added rcount and bcount
tracker.php:      $sql = "insert into $S->masterdb.dayrecords (fid, ip, site, page, finger, jsin, jsout, dayreal, rcount, daybots, dayvisits, visits, lasttime) ".
tracker.php:      $S->query($sql);
tracker.php:  // BLP 2022-12-06 - now $botAs will have counted and maybe robot or sitemap or zero.
tracker.php:  $sql = "update $S->masterdb.tracker set botAs='$botAs', isJavaScript='$java', endtime=now(), ".
tracker.php:  $S->query($sql);
tracker.php:  if(!$S->isMyIp($ip) && $DEBUG_TIMER) error_log("tracker: $id, $ip, $site, $thepage, TIMER2, botAs=$botAs, visits: $visits, jsin=$js, jsout=$js2, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php://    <img id='logo' data-image="image" src="https://bartonphillips.net/images/blp-image.png"></a>
tracker.php:// <p style='color: red; background-color: #FFE4E1; padding: 10px'>
tracker.php://error_log("tracker: site=$S->siteName, \$_GET: " . print_r($_GET, true));
tracker.php:    error_log("tracker: type=$msg, NO ID, $S->ip, $S->agent");
tracker.php:    $errno = -99;
tracker.php:    // No id, and ip, site, thepage, and agent are not yet valid. Use $S->...
tracker.php:    $sql = "insert into $S->masterdb.badplayer (ip, site, page, type, count, errno, errmsg, agent, created, lasttime) ".
tracker.php:           "values('$S->ip', '$S->siteName', '$S->self', '$msg', 1, '$errno', '$errmsg', '$S->agent', now(), now()) ".
tracker.php:    error_log("tracker ID_IS_NOT_NUMERIC: ip=$S->ip, id(value)=$id, agent=$S->agent");
tracker.php:    $S->query($sql);
tracker.php:      error_log("tracker Switch Error: $S->ip, $type, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php:    $sql = "select site, ip, page, finger, hex(isJavaScript), agent from $S->masterdb.tracker where id=$id";
tracker.php:    if($S->query($sql)) {
tracker.php:      [$site, $ip, $thepage, $finger, $js, $agent] = $S->fetchrow('num');
tracker.php:      throw new Exception("tracker: NO RECORD for id=$id, type=$msg", -100); // This will be caught below.
tracker.php:    $errno = $e->getCode();
tracker.php:    $errmsg = $e->getMessage();
tracker.php:      $sql = "insert into $S->masterdb.tracker (id, ip, error, starttime, lasttime) ".
tracker.php:             "values($id, '$S->ip', 'Select failed insert on $ip $msg', now(), now()) ".
tracker.php:      $S->query($sql);
tracker.php:      error_log("tracker: $id, \$S->ip=$S->ip, $S->siteName, $S->self, SELECT_FAILED_INSERT_OK_{$ip}_{$msg}, ".
tracker.php:                "err=$errno, errmsg=$errmsg, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php:      $errno = $e->getCode();
tracker.php:      $errmsg .= "::" . $e->getMessage();
tracker.php:      $sql = "insert into $S->masterdb.badplayer (ip, id, site, page, type, count, errno, errmsg, agent, created, lasttime) ".
tracker.php:             "values('$S->ip', $id, '$S->siteName', '$S->self', '$msg', 1, '$errno', '$errmsg', '$S->agent', now(), now()) ".
tracker.php:      if(!$S->query($sql)) {
tracker.php:        error_log("tracker: \$S->ip=$S->ip, \$ip=$ip badplayer - could not do insert/update");
tracker.php:  if($DEBUG_GET1) error_log("tracker: $id, $ip, $site, $thepage, $msg, java=$js, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php:  if(empty($agent) || $S->isBot($agent)) {
tracker.php:    if($DEBUG_ISABOT) error_log("tracker: $id, $ip, $site, $thepage, ISABOT_{$msg}, image=$image, time=" . (new DateTime)->format('H:i:s:v'));
tracker.php:    $S->query("insert into $S->masterdb.tracker (id, ip, site, page, agent, isJavaScript, error, starttime, lasttime) ".
tracker.php:    // BLP 2023-01-18 - If this is a bot change the image.
tracker.php:  if($DEBUG_GET2) error_log("tracker: $id, $ip, $site, $thepage, $msg -- referer=$ref");
tracker.php:    $sql = "insert into $S->masterdb.tracker (id, ip, site, page, agent, referer, isJavaScript, error, starttime, lasttime) ".
tracker.php:    $sql = "insert into $S->masterdb.tracker (id, ip, site, page, agent, isJavaScript, error, starttime, lasttime) ".
tracker.php:  $S->query($sql);
tracker.php:    header("Content-Type: text/css");
tracker.php:  // BLP 2022-08-15 - Get the default image. Use the $S->defaultImage if not null
tracker.php:  $img = $S->defaultImage ?? "https://bartonphillips.net/images/blank.png";
tracker.php:      // BLP 2022-08-15 - Use $S->imageLocation if not null.
tracker.php:      $img = ($S->imagesLocation ?? "https://bartonphillips.net") . $image;
tracker.php:  header("Content-type: image/$imageType");
tracker.php:  //error_log("tracker $S->siteName, $S->ip: GOAWAY NO ID");
tracker.php:  $errno = -102;
tracker.php:  $S->query("insert into $S->masterdb.badplayer (ip, site, page, type, count, errno, errmsg, agent, created, lasttime) " .
tracker.php:            "values('$S->ip', '$S->siteName', '$S->self', 'GOAWAY NO ID', 1, '$errno', '$errmsg', '$S->agent', now(), now()) ".
tracker.php:  $S->query("insert into $S->masterdb.tracker (id, site, ip, agent, isJavaScript, starttime, lasttime) ".
tracker.php:            "values($id, '$S->siteName', '$S->ip', '$S->agent', " . TRACKER_GOAWAY . ", now(), now()) ".
tracker.php:  $errno = -103;
tracker.php:  $S->query("insert into $S->masterdb.badplayer (ip, id, site, page, type, count, errno, errmsg, agent, created, lasttime) " .
tracker.php:            "values('$S->ip', $id, '$S->siteName', '$S->self', 'GOAWAY', 1, '$errno', '$errmsg', '$S->agent', now(), now()) ".
tracker.php:  $S->query($sql);
tracker.php:  $finger = $S->fetchrow('num')[0] ?? "NONE";
tracker.php:error_log("tracker: $id, $S->ip, $S->siteName, $S->self, GOAWAY, $S->agent, finger=$finger{$request}");
whatisloaded.class.php:      $this->site = require(getenv("SITELOADNAME"));
whatisloaded.class.php:      $this->site = SITELOAD_VERSION;
whatisloaded.class.php:      $this->siteClass = \SiteClass::getVersion();
whatisloaded.class.php:      $this->siteClass = \SiteClass::getVersion();
whatisloaded.class.php:      $this->database = \Database::getVersion();
whatisloaded.class.php:      $this->dbMysqli = \dbMysqli::getVersion();
whatisloaded.class.php:      $this->helper = HELPER_FUNCTION_VERSION;
whatisloaded.class.php:      $this->tracker = require(SITECLASS_DIR . "/tracker.php");
whatisloaded.class.php:      $this->beacon = require(SITECLASS_DIR . "/beacon.php");
whatisloaded.class.php:        $this->javaScript = $m[1];
whatisloaded.class.php:      $this->dbTables = \dbTables::getVersion();
whatisloaded.class.php:      $this->ErrorClass= \ErrorClass::getVersion();
whatisloaded.class.php:      $this->SqlException = \SqlException::getVersion();
whatisloaded.class.php:      $this->dbAbstract = \dbAbstract::getVersion();
whatisloaded.class.php:      $whatis = $this->getVersion(); // Get the version
whatisloaded.class.php:<tr><td>siteload.php</td><td>$this->site</td></tr>
whatisloaded.class.php:<tr><td>SiteClass.class.php</td><td>$this->siteClass</td></tr>
whatisloaded.class.php:<tr><td>Database.class.php</td><td>$this->database</td></tr>
whatisloaded.class.php:<tr><td>dbMysqli.class.php</td><td>$this->dbMysqli</td></tr>
whatisloaded.class.php:<tr><td>dbTables.class.php</td><td>$this->dbTables</td></tr>
whatisloaded.class.php:<tr><td>ErrorClass.class.php</td><td>$this->ErrorClass</td></tr>
whatisloaded.class.php:<tr><td>SqlException.class.php</td><td>$this->SqlException</td></tr>
whatisloaded.class.php:<tr><td>dbAbstract.class.php</td><td>$this->dbAbstract</td></tr>
whatisloaded.class.php:<tr><td>tracker.php</td><td>$this->tracker</td></tr>
whatisloaded.class.php:<tr><td>beacon.php</td><td>$this->beacon</td></tr>
whatisloaded.class.php:<tr><td>helper-functions.php</td><td>$this->helper</td></tr>
whatisloaded.class.php:      return [$tbl, "siteload.php"=>$this->site, "SiteClass.class.php"=>$this->siteClass,
whatisloaded.class.php:      "Database.class.php"=>$this->database, "dbMysqli.class.php"=>$this->dbMysqli,
whatisloaded.class.php:      "dbTables.class.php"=>$this->dbTables, "ErrorClass.class.php"=>$this->ErrorClass,
whatisloaded.class.php:      "SqlException.class.php"=>$this->SqlException, "dbAbstract.class.php"=>$this->dbAbstract,
whatisloaded.class.php:      "tracker.php"=>$this->tracker, "beacon.php"=>$this->beacon,
whatisloaded.class.php:      "tracker.js"=>$this->javaScript, "helper-functions.php"=>$this->helper];
whatisloaded.class.php:return (new WhatIsLoaded)->getWhatIsInfo();
